<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>База данных клиентов</title>
  <link rel="stylesheet" href="/style.css">
</head>
<body>
  <h1>Клиенты</h1>

  <h2>GET</h2>
  <button onclick="getRows()">GET</button>
  <pre id="getResult"></pre>

  <h2>POST</h2>
  Name: <input id="postName" type="text">
  Birthday: <input id="postBday" type="date" max="">
  <button onclick="postRow()">POST</button>
  <pre id="postResult"></pre>

  <h2>DELETE</h2>
  ID: <input id="deleteId" type="number">
  <button onclick="deleteRow()">DELETE</button>
  <pre id="deleteResult"></pre>

  <h2>UPDATE</h2>
  ID: <input id="putId" type="number" onchange="loadRow()">
  Name: <input id="putName" type="text">
  Birthday: <input id="putBday" type="date" max="">
  <button onclick="putRow()">UPDATE</button>
  <pre id="putResult"></pre>

  <script>
    async function getRows() {
      try {
        const res = await fetch('/api/db');
        const data = await res.json();
        document.getElementById('getResult').textContent = JSON.stringify(data, null, 2);
      } catch (err) {
        document.getElementById('getResult').textContent = 'Ошибка: ' + err.message;
      }
    }
    const today = new Date().toISOString().split('T')[0];
document.getElementById('postBday').setAttribute('max', today);
document.getElementById('putBday').setAttribute('max', today);

    async function postRow() {
    const name = document.getElementById('postName').value.trim();
    const bday = document.getElementById('postBday').value;

    try {
        const res = await fetch('/api/db', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({name, bday})
        });
        const data = await res.json();
        if (!res.ok) throw new Error(data.error || 'Ошибка при добавлении');
        document.getElementById('postResult').textContent = JSON.stringify(data, null, 2);
        getRows(); // обновляем список
    } catch (err) {
        document.getElementById('postResult').textContent = 'Ошибка: ' + err.message;
    }
}

    async function deleteRow() {
      const id = parseInt(document.getElementById('deleteId').value, 10);
      const res = await fetch(`/api/db?id=${id}`, {method: 'DELETE'});
      const data = await res.json();
      document.getElementById('deleteResult').textContent = JSON.stringify(data, null, 2);
    }

    async function loadRow() {
      const id = parseInt(document.getElementById('putId').value, 10);
      if (!id) return;
      const res = await fetch(`/api/db?id=${id}`);
      const data = await res.json();
      if (!data) return;
      document.getElementById('putName').value = data.name || '';
      document.getElementById('putBday').value = data.bday || '';
    }

    async function putRow() {
    const id = parseInt(document.getElementById('putId').value, 10);
    const name = document.getElementById('putName').value.trim();
    const bday = document.getElementById('putBday').value;

    try {
        const res = await fetch('/api/db', {
            method: 'PUT',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({id, name, bday})
        });
        const data = await res.json();
        if (!res.ok) throw new Error(data.error || 'Ошибка при обновлении');
        document.getElementById('putResult').textContent = JSON.stringify(data, null, 2);
        getRows(); // обновляем список
    } catch (err) {
        document.getElementById('putResult').textContent = 'Ошибка: ' + err.message;
    }
}
  </script>
</body>
</html>
